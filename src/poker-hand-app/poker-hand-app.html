<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/polymer/lib/elements/dom-repeat.html">

<link rel="import" href="../../bower_components/game-card/game-card.html">
<link rel="import" href="../../bower_components/random-list/random-list.html">

<dom-module id="poker-hand-app">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>

    <random-list id="randomCards"></random-list>

    <template is="dom-repeat" items="[[secretHand]]">
      <game-card symbol="[[item.symbol]]" rank="[[item.rank]]"></game-card>
    </template>
  </template>

  <script>
    /**
     * @customElement
     * @polymer
     */
    class PokerHandApp extends Polymer.Element {
      static get is() { return 'poker-hand-app'; }
      static get properties() {
        return {
          secretHand: {
            type: Array,
          },
        };
      }

      ready() {
        super.ready();

        const symbols = [ '♦', '♣', '♥', '♠' ];
        const ranks = [ 'a', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'j', 'q', 'k' ];

        const getSuite = (symbol) => {
          let rankIndex = 0;
          return new Array(13).fill({}).map(element => {
            const card = {
              symbol,
              rank: ranks[rankIndex],
            };
            rankIndex = rankIndex + 1;
            return card;
          });
        };

        const diamonds = getSuite(symbols[0]);
        const clubs = getSuite(symbols[1]);
        const hearts = getSuite(symbols[2]);
        const spades = getSuite(symbols[3]);

        const cards = diamonds.concat(clubs).concat(hearts).concat(spades);

        const result = this.$.randomCards.pickRandomList({
          display: true,
          source: cards,
          max: 5,
        });

        this.secretHand = result.list.map(card => JSON.parse(card));
      }
    }

    window.customElements.define(PokerHandApp.is, PokerHandApp);
  </script>
</dom-module>
